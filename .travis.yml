language: python
python:
  - '2.7'

# Setting environment variables that can be used by Git via Travis to identify current user
env:
  global:
    # Generated by `travis encrypt GIT_NAME=..." GIT_EMAIL=... GH_TOKEN=...`
    secure: nrNOM7DRXT8xSdGfEjTyx1LVV7rKCb/ZC6aHexzg6TW1CFA+CZMVzZHCvWfuUz0Qc8rLkUF9K5ZIdXW16x1gvTAS+dL2Y2FvQ3HgX6/QHbKDBUGXNbRYCSsLclwxLn6fYmSCxxPt9OqLIoY1Mx+9r+59a9B+tSP4+9BSSbdUUM8=

install: pip install -r requirements.txt

# Discover and run all plugin tests
script: python -m unittest discover

after_script:
  - git config --global user.name "${GIT_NAME}"
  - git config --global user.email "${GIT_EMAIL}"
  - git config credential.helper "store --file=.git/credentials"
  - echo "https://${GH_TOKEN}:@github.com" > .git/credentials
#  - node ./node_modules/grunt-cli/bin/grunt release

# Build and Deploy a new plugin ZIP bundle
after_success:
  - git remote -v
  - bash after_success.sh
  - npm install
#  - git remote set-url origin "https://github.com/ArabicXBMC/plugin.video.dailytube4u.com.git"
  - node tag_version

# Deploy build to GitHub Releases
deploy:
  provider: releases
  api_key:
    secure: WbJqSl54/WQ++OQlU0EnssMuv/pZhXD4epBVYD4MHNmNbFOpaSD8ELyXIhpa7JUEWEsFziV1JHDpUIn0rokj1qvC23EDrd80knN6AMWnwzHAmN96teVIqJhcnmySx7dk7ObNz7YoBGMvSxuhRqnJ6fyN3yLl6asDfYWw+MrE5+w=
  file: plugin.video.dailytube4u.com.zip
  skip_cleanup: true
  on:
    tags: true
    branch: master
    repo: ArabicXBMC/plugin.video.dailytube4u.com