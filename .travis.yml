language: python
python:
  - '2.7'

# Setting environment variables that can be used by Git via Travis to identify current user
env:
  global:
    # Generated by `travis encrypt GIT_NAME=..." GIT_EMAIL=... GH_TOKEN=...`
    secure: nrNOM7DRXT8xSdGfEjTyx1LVV7rKCb/ZC6aHexzg6TW1CFA+CZMVzZHCvWfuUz0Qc8rLkUF9K5ZIdXW16x1gvTAS+dL2Y2FvQ3HgX6/QHbKDBUGXNbRYCSsLclwxLn6fYmSCxxPt9OqLIoY1Mx+9r+59a9B+tSP4+9BSSbdUUM8=

install: pip install -r requirements.txt

# Discover and run all plugin tests
script: python -m unittest discover

before_script:
  - git config --global user.name "${GIT_NAME}"
  - git config --global user.email "${GIT_EMAIL}"
  - git config credential.helper "store --file=.git/credentials"
  - echo "https://${GH_TOKEN}:@github.com" > .git/credentials

# Build and Deploy a new plugin ZIP bundle
after_success:
  - git tag -n

  # Get latest tags from remote
  - git fetch --tags

  # Get the latest tag name
  - git describe --tags `git rev-list --tags --max-count=1`

  # Set HTTPS remote origin for repository
  - git remote set-url origin "https://github.com/ArabicXBMC/plugin.video.dailytube4u.com.git"

  # ...
  - git tag -n
  - bash after_success.sh
  - npm install
  - node tag_version

# Deploy build to GitHub Releases
deploy:
  provider: releases
  api-key:
    secure: i+DhcN8WKYhwYkviS72nWc8Y7i4GP11BntvnadQvATbyr2TGrtwd7b3hQLG/srVnSxl8L81E6pzOWST/1Nz1cYr6iiTeAhH+l0ZsTfqzYBEmfnGEmSoeRER0ZmUIPsu/2jLHXPsGGDPPI5k53OPlgeZOhmoeqii/PQpDl7R3lKQ=
  file: plugin.video.dailytube4u.com.zip
  skip_cleanup: true
  on:
    tags: true
    branch: master
    repo: ArabicXBMC/plugin.video.dailytube4u.com